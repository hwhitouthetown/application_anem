<?php

namespace AppBundle\Repository;

use FOS\UserBundle\Model\UserInterface;
use FOS\UserBundle\Model\UserManagerInterface;


/**
 * UserRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class AccessTokenRepository extends \Doctrine\ORM\EntityRepository
{
	public function findTokenByUser($id){
		
		$qb = $this->createQueryBuilder('t')->select('t.id','t.client','t.token','u.expiresAt')->where('t.user = :user')->setParameter('user',$id)->getQuery(); 
		return $qb->getResult();
	}


	public function generateToken(){
	
		  $tokenObject = new AccessToken(); 
          $token = bin2hex(random_bytes(86));

          $tokenObject->setUser($user);

          $tokenObject->setToken($token);

          $em = $this->getDoctrine()->getManager();
          $em->persist($tokenObject);
          $em->flush(); 	


        return $token;    
	}
}
